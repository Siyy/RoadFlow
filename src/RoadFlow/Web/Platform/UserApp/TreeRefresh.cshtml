@{
    string id = Request["refreshid"];
    string userID = Request.QueryString["userid"];
    Guid rid;
    if (!id.IsGuid(out rid))
    {
        Response.Write("[]");
        return;
    }
    Business.Platform.RoleApp BRoleApp = new Business.Platform.RoleApp();
    Business.Platform.UsersApp BUsersApp = new Business.Platform.UsersApp();
    var childs = BRoleApp.GetChild(rid);
    
    //加载个人应用
    if(userID.IsGuid())
    {
        BUsersApp.AppendUserApps(userID.ToGuid(), rid, childs);
    }
    
    System.Text.StringBuilder json = new System.Text.StringBuilder("[", childs.Count * 50);
    int count = childs.Count;
    int i = 0;
    foreach (var child in childs.OrderBy(p=>p.Sort))
    {
        json.Append("{");
        json.AppendFormat("\"id\":\"{0}\",", child.ID.ToString());
        json.AppendFormat("\"title\":\"{0}\",", child.Title);
        json.AppendFormat("\"ico\":\"{0}\",", child.Ico);
        json.AppendFormat("\"link\":\"{0}\",", "");
        json.AppendFormat("\"type\":\"{0}\",", child.Type);
        json.AppendFormat("\"model\":\"{0}\",", "");
        json.AppendFormat("\"width\":\"{0}\",", "");
        json.AppendFormat("\"height\":\"{0}\",", "");
        json.AppendFormat("\"hasChilds\":\"{0}\",", BRoleApp.HasChild(child.ID) || BUsersApp.HasChild(child.ID) ? "1" : "0");
        json.AppendFormat("\"childs\":[");
        json.Append("]");
        json.Append("}");
        if (i++ < count - 1)
        {
            json.Append(",");
        }
    }
    json.Append("]");
    Response.Write(json.ToString());
}